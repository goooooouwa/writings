<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>构建嵌入式Linux系统 | 开放笔记</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="构建嵌入式Linux系统" />
<meta name="author" content="徐顺发" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="流程综述" />
<meta property="og:description" content="流程综述" />
<link rel="canonical" href="https://goooooouwa.github.io/coding/2012/10/30/gou-jian-qian-ru-shi-linux-xi-tong.html" />
<meta property="og:url" content="https://goooooouwa.github.io/coding/2012/10/30/gou-jian-qian-ru-shi-linux-xi-tong.html" />
<meta property="og:site_name" content="开放笔记" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-10-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="构建嵌入式Linux系统" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"徐顺发"},"dateModified":"2012-10-30T00:00:00+00:00","datePublished":"2012-10-30T00:00:00+00:00","description":"流程综述","headline":"构建嵌入式Linux系统","mainEntityOfPage":{"@type":"WebPage","@id":"https://goooooouwa.github.io/coding/2012/10/30/gou-jian-qian-ru-shi-linux-xi-tong.html"},"url":"https://goooooouwa.github.io/coding/2012/10/30/gou-jian-qian-ru-shi-linux-xi-tong.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://goooooouwa.github.io/feed.xml" title="开放笔记" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-669F0VG7BL"></script>
<script>
  window['ga-disable-G-669F0VG7BL'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-669F0VG7BL');
</script>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="/assets/css/google-custom-search-style-fix.css">
<script data-ad-client="ca-pub-6847741633817418" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script src=/assets/javascript/chartjs-2.9.3/chart.min.js></script>
<script src=/assets/javascript/mermaid-8.7.0/mermaid.min.js></script></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">开放笔记</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/categories.html">分类</a><a class="page-link" href="/tags.html">标签</a><a class="page-link" href="/wiki.html">Wiki</a><a class="page-link" href="/docs.html">共享文档</a><a class="page-link" href="/about/">关于作者</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">构建嵌入式Linux系统</h1>
    <p class="post-meta"><time class="dt-published" datetime="2012-10-30T00:00:00+00:00" itemprop="datePublished">
        Oct 30, 2012
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="流程综述">流程综述</h2>

<ol>
  <li>将系统磁盘挂载在 host 主机上，</li>
  <li>使用主机对磁盘进行分区，</li>
  <li>安装文件系统和 swap 到分区（格式化），</li>
  <li>将 cross-compiling 得到的基本文件系统（包括：boot，dev，etc，kernel image，kernel modules，等）拷贝到磁盘的文件系统中，</li>
  <li>将 bootloader 安装到磁盘 volume boot record 上</li>
</ol>

<p>这样就构建了一个基本的嵌入式系统。</p>

<p>后面阶段（如，调试）便可以通过串口或网口连接主机和嵌入式系统的方式来完成，不用再移动嵌入式系统磁盘。</p>

<h2 id="storage-device-setup">Storage device setup</h2>

<p>1.Partition storage device.
<img src="https://goooooouwa.eu.org:8143/static/images/pMuTGYp.png" alt="Imgur" /></p>

<p>Bootloader, Boot parameters, Kernel, Root filesystem</p>

<p>2.Install bootloader, kernel and root filesystem.</p>

<p>3.Config bootloader to boot kernel.</p>

<h2 id="kernel-compilation">Kernel compilation</h2>

<p>Compiling the kernel involves a number of steps:</p>

<ol>
  <li>building the kernel dependencies,</li>
  <li>building the kernel image,</li>
  <li>and building the kernel modules.</li>
</ol>

<p>具体如下：</p>

<p>Compile the Kernel</p>

<ol>
  <li>Config<br />
<code class="language-plaintext highlighter-rouge">$make menuconfig</code></li>
  <li>Build
    <ol>
      <li>Build kernel dependencies<br />
<code class="language-plaintext highlighter-rouge">$make clean dep</code></li>
      <li>Build kernel image<br />
<code class="language-plaintext highlighter-rouge">$make zImage</code></li>
      <li>Build kernel modules<br />
<code class="language-plaintext highlighter-rouge">$make modules</code></li>
      <li>(Optional) clean up source( !backup .config first)<br />
<code class="language-plaintext highlighter-rouge">$make distclean</code></li>
    </ol>
  </li>
  <li>Install
    <ol>
      <li>install kernel
        <ol>
          <li>for bootloader which reads filesystem<br />
<code class="language-plaintext highlighter-rouge">$cp vmlinuz /boot</code></li>
          <li>for bootloader which cant read filesystem<br />
<code class="language-plaintext highlighter-rouge">$dd if=vmlinux.img of=/dev/sda1</code></li>
        </ol>
      </li>
      <li>install kernel modules<br />
<code class="language-plaintext highlighter-rouge">$make modules_install</code></li>
    </ol>
  </li>
</ol>

<h2 id="c-library-compilation">C library compilation</h2>

<ol>
  <li>Extract archive</li>
</ol>

<p>As with the previous packages, we start by extracting the C library from the archive we downloaded earlier:</p>

<p><code class="language-plaintext highlighter-rouge">$ cd ${PRJROOT}/build-tools</code>
<code class="language-plaintext highlighter-rouge">$ tar xvzf glibc-2.2.3.tar.gz</code></p>

<ol>
  <li>configure</li>
</ol>

<p>We can now proceed to preparing the build of the C library in the build-glibc directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd build-glibc
$ CC=i386-linux-gcc ../glibc-2.2.3/configure --host=$TARGET \
&gt; --prefix="/usr" --enable-add-ons \
&gt; --with-headers=${TARGET_PREFIX}/include
</code></pre></div></div>

<ol>
  <li>make</li>
</ol>

<p>With the configuration script done, we can now compile glibc:</p>

<p><code class="language-plaintext highlighter-rouge">$ make</code></p>

<ol>
  <li>install</li>
</ol>

<p>Once the C library is built, we can now install it:</p>

<p><code class="language-plaintext highlighter-rouge">$ make install_root=${TARGET_PREFIX} prefix="" install</code></p>

<ol>
  <li>one more thing</li>
</ol>

<p>There is one last step we must carry out to finalize glibc’s installation: the configuration of the libc.so file.</p>

<p>This file is used during the linking of applications to the C library and is actually a link script. It contains
references to the various libraries needed for the real linking. The installation carried out by our make
install above assumes that the library is being installed on a root filesystem and hence uses absolute
pathnames in the libc.so link script to reference the libraries. Since we have installed the C library in a
nonstandard directory, we must modify the link script so that the linker will use the appropriate libraries.</p>

<p>Along with the other components of the C library, the link script has been installed in the ${TARGET_PREFIX}/lib directory.</p>

<p>In its original form, libc.so looks like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/* GNU ld script
 Use the shared library, but some functions are only in
 the static library, so try that secondarily. */
GROUP ( /lib/libc.so.6 /lib/libc_nonshared.a )
</code></pre></div></div>

<p>This is actually quite similar, if not identical, to the libc.so that has already been installed by your
distribution for your native C library in /usr/lib/. Since you may need your target’s default script
sometime, I suggest you make a copy before modifying it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ${TARGET_PREFIX}/lib
$ cp ./libc.so ./libc.so.orig
</code></pre></div></div>

<h2 id="设置-bootloader">设置 bootloader</h2>

<p>设置 U-Boot</p>

<h3 id="introduction">Introduction</h3>

<p>构建 U-Boot 之前，你需要针对你的目标系统来设定它。该套件为相当多的开发板预先设定了一些配置，所以你的目标系统可能已经预先设定好的配置。对于每个受到支持的开发板，U-Boot 的 Makefile 通常都会包含一个相应的 boardname_config 构建目标，可用于替特定的开发板设定 U-Boot 的构建设置。</p>

<h3 id="configure--build-u-boot">Configure &amp; build U-Boot</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ make gta01_config
$ make ARCH=arm CROSS_COMPILE=arm-linux- u-boot.udfu
</code></pre></div></div>

<h3 id="u-boot-编译期间所产生的文件">U-Boot 编译期间所产生的文件</h3>

<ol>
  <li>u-boot.map 符号对应</li>
  <li>u-boot U-Boot 可执行文件，采用 ELF 二进制格式</li>
  <li>u-boot.bin U-Boot 原始二进制映像，可以被写入引导存储设备</li>
  <li>u-boot.udfu U-Boot 映像，采用 OpenMoKo 设备所使用的特殊文件格式 U-Boot Device Firmware Upgrade( DFU)</li>
</ol>

<h3 id="install-u-boot">Install U-Boot</h3>

<p>现在可以使用适当的程序将 U-Boot 映像下载到你的目标系统的引导存储设备。如果你的目标系统上没有安装任何 bootloader，你需要使用一个硬件烧录设备，例如一个 Flash 编程器或一个 BDM/JTAG 调试器，将 U-Boot 复制到所设定的 Flash 地址。</p>

<h2 id="ptxdist-configuration-method">Ptxdist configuration method</h2>

<ol>
  <li>Install dependencies: <code class="language-plaintext highlighter-rouge">libncurses-dev gawk texinfo gettext</code></li>
  <li>Exact <code class="language-plaintext highlighter-rouge">ptxdist-version.tar.bz2  OELAS.toolchain-version.tar.bz2</code></li>
  <li>Install ptxdist in /install/path/<br />
<code class="language-plaintext highlighter-rouge">$ cd ptxdist-version; ./configure --prefix=/install/path/; make; make install;</code></li>
  <li>Next step is to select configuration for your (embedded) project using ptxdist.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /project/path/
$# setup project search path and source directories.
$ ptxdist setup
$# select ptxdist configuration file
$ ptxdist select /path/to/OELAS.toolchain/ptxconfig/configuration-file.ptxconfig
$# configure project options, like product install path, ptxdist version, etc.
$ ptxdist menuconfig
</code></pre></div></div>

<ol>
  <li>Build cross-tool<br />
<code class="language-plaintext highlighter-rouge">$ ptxdist go</code></li>
</ol>

  </div>

  <!-- <div class="reward">
    <p>觉得文章对你有帮助？打赏以支持作者持续创作：</p>
    <div class="reward-button">
      <span class="alipay-code"><img class="alipay-img wdp-appear" alt="支付宝打赏" src="https://goooooouwa.eu.org:8143/static/images/alipay_paycode.jpg"></span>
    </div>
  </div> --><script src="https://utteranc.es/client.js" repo="goooooouwa/goooooouwa.github.io" issue-term="pathname"
    theme="github-light" crossorigin="anonymous" async>
    </script>

  <a class="u-url" href="/coding/2012/10/30/gou-jian-qian-ru-shi-linux-xi-tong.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>订阅</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">徐顺发</li>
          <li><a class="u-email" href="mailto:gouwa5700 (at) gmail (dot) com">gouwa5700 (at) gmail (dot) com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>记录生活、学习和思考
</p>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />本网站采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/goooooouwa" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/Goooooouwa" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>